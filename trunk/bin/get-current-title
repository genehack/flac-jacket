#! /usr/bin/perl

use strict;
use warnings;

use FindBin;
use lib "$FindBin::RealBin/../lib";
use Squeezebox;

my $player = shift || Squeezebox::get_player_from_current_host();

unless ( $player ) {
  print qq|No player running.|;
  exit;
}

my %tokens = map { $_ => '' } qw/ title path album artist /;

foreach my $token ( keys %tokens ) {
  $tokens{$token} = Squeezebox::fetch_token( $player , $token );
}

unless ( $tokens{path} ) {
  print qq|Stopped.|;
  exit;
}

if ( $tokens{path} eq '?' ) { print qq|Nothing currently playing.| }
else {
  my $path = $tokens{path};
  if ( my( $track ) = $path =~ m|/\d-(\d\d)-| ) {
    $track = sprintf "%d" , $track;

    print qq|$track - "$tokens{title}" - _$tokens{album}_ - $tokens{artist}|;
  }
  else {
    print qq|$path|; 
  }
}

